# Лабораторная работа №2. Паттерн «Наблюдатель»

- [Лабораторная работа №2. Паттерн «Наблюдатель»](#лабораторная-работа-2-паттерн-наблюдатель)
  - [Критерии оценивания лабораторной работы](#критерии-оценивания-лабораторной-работы)
  - [Задание 1 — Отображение полной статистической информации — 20 баллов](#задание-1--отображение-полной-статистической-информации--20-баллов)
  - [Задание 2 — Безопасное уведомление наблюдателей — 10 баллов](#задание-2--безопасное-уведомление-наблюдателей--10-баллов)
  - [Задание 3 — Приоритеты наблюдателей — 30 баллов](#задание-3--приоритеты-наблюдателей--30-баллов)
  - [Задание 4 — Наблюдение за несколькими субъектами — 20 баллов](#задание-4--наблюдение-за-несколькими-субъектами--20-баллов)
  - [Задание 5 — Слежение за ветром — 20 баллов](#задание-5--слежение-за-ветром--20-баллов)
  - [Задание 6 — Слежение за ветром (Duo edition) — 20 баллов](#задание-6--слежение-за-ветром-duo-edition--20-баллов)
  - [Задание 7 — Подписка лишь на интересующие события — 40 баллов](#задание-7--подписка-лишь-на-интересующие-события--40-баллов)
  - [Задание 8 — Реализация паттерна Observer с использованием сигналов и слотов — 50 баллов](#задание-8--реализация-паттерна-observer-с-использованием-сигналов-и-слотов--50-баллов)

## Критерии оценивания лабораторной работы

При сдаче лабораторной работы студент должен уметь ответить на вопросы преподавателя насчёт используемых паттернов проектирования, уметь изобразить схему паттерна на диаграмме классов, а также продемонстрировать диаграмму классов своего приложения.

- На оценку «удовлетворительно» необходимо набрать 80 баллов.
- На оценку «хорошо» необходимо набрать 120 баллов.
- На оценку «отлично» необходимо набрать 180 баллов.

**Программа должна конкретно работать, когда индикаторы разрушаются раньше,
чем разрушится метеостанция, которая продолжает отправлять уведомления
об изменении погодных условий.**

## Задание 1 — Отображение полной статистической информации — 20 баллов

Текущая реализация программы Weather Station отображает
**статистические** данные только о температуре. Доработайте программу
так, чтобы аналогичная информация отображалась о влажности и давлении.
Приложите усилия для устранения дублирования кода, чтобы при появлении
нового типа датчиков было легче рассчитать и отобразить по ним
статистику.

## Задание 2 — Безопасное уведомление наблюдателей — 10 баллов

В приложении Weather Station работа метода NotifyObservers может
привести к неопределенному поведению, если из метода Update наблюдатель
выполнит удаление себя из списка наблюдателей. Придумайте и реализуйте
решение для данной проблемы.

Напишите модульный тест для данного сценария.

## Задание 3 — Приоритеты наблюдателей — 30 баллов

В приложении Weather Station порядок оповещения наблюдателей заранее
неизвестен. Доработайте приложение таким образом, чтобы при регистрации
наблюдателя можно было задать его приоритет в виде целого числа.
Наблюдатели с более высоким приоритетом должны получать оповещения от
субъекта раньше, чем наблюдатели с более низким приоритетом.

Если наблюдатель уже подписан, то повторная подписка не должна выполняться.

Методы `RegisterObserver` и `RemoveObserver` должны иметь сложность лучше линейной, а также обеспечивать гарантию безопасности исключений не ниже базовой (это касается всего кода, который вы пишете, но обратите пристальное внимание на эти 2 метода).

Напишите модульный тест для данного функционала.

## Задание 4 — Наблюдение за несколькими субъектами — 20 баллов

От заказчика поступил запрос на разработку приложения Weather Station
Duo, предназначенного для работы с новейшими устройствами, имеющими 2
метеостанции. Такие устройства позволяют один набор датчиков разместить
внутри помещения, а другой - снаружи. Соответственно, в такой программе
существуют 2 объекта WeatherData.

Индикаторы в программе должны стать продвинутыми — теперь каждый
индикатор в такой программе отображает показатели сразу с двух станций
(in и out). Придумайте решение, позволяющее наблюдателю узнать, от
какого субъекта было получено уведомление.

Напишите модульный тест для данного функционала.

## Задание 5 — Слежение за ветром — 20 баллов

На основе программы Weather Station разработайте приложение Weather
Station Pro, предназначенное для работы с Pro-версией метеостанции,
оснащенной двумя дополнительными датчиками, сообщающими о скорости ветра
(м/с) и его направлении (в градусах, где 0 — север, 90-восток, 180-юг,
270-запад). Придумайте, какие особенности следует учесть в реализации
статистического индикатора, чтобы обеспечить корректный расчет среднего
направления ветра.

## Задание 6 — Слежение за ветром (Duo edition) — 20 баллов

Заказчик не дремлет и захотел программу Weather Station Pro Duo, в
которой метеостанция, следящая за погодой вне помещения, заменена на
Pro-версию. Метеостанция, следящая за погодой внутри, осталась прежней,
т.к. внутри помещений ветра нет, что позволило снизить себестоимость
изделия. Индикаторы Duo-версии также обновились — сведения о погоде
снаружи помещения включают в себя данные о ветре и направлении.

Таким образом, один и тот же наблюдатель (индикатор) должен быть способен
обрабатывать уведомления от двух разных типов субъектов (метеостанций).

Архитектура должна быть такой, чтобы если в требования добавится необходимость
отображать на одном из индикаторов пульс пациента (например, в медклинике)
в дополнение к метеоданным, внутри структуры с информацией о погоде не было данных о пульсе.

## Задание 7 — Подписка лишь на интересующие события — 40 баллов

От пользователей программы Weather Station Pro, использующих
метеостанцию во время зимней рыбалки, поступил запрос на повышение
энергоэффективности устройства, чтобы их аккумуляторной батареи хватало
на большее время.

В ходе разбора ситуации выяснилось, что пользователям нужен упрощенный
тип индикатора, отображающий лишь текущую температуру и атмосферное
давление, в то время как основной расход аккумулятора происходил из-за
слишком частой обработки уведомлений, связанных с изменениями
направления и силы ветра. Рыбакам зимой не важно, откуда дует ветер,
важно не засидеться на морозе ниже критической отметки, а также следить
за атмосферным давлением, т.к. поведение некоторых рыб зависит[^1] от
данного параметра.

Реализуйте возможность наблюдателю указывать тип интересующего их
изменения. При этом один и тот же наблюдатель должен иметь возможность
подписаться на несколько различных типов событий (например, несколько
раз зарегистрировав себя подписчиком разных типов событий), а также
динамически отписываться от событий, в которых он больше не
заинтересован.

Кроме weather station сделать другой набор
observable-observer (например, кот и мышь и собака). Интерфейс и базовая
реализация observable должны быть универсальными для использования как
метеостанцией, так и животными.

При добавлении подписки на интересующие события должен сохраниться функционал
предыдущих заданий, таких как поддержка приоритетов наблюдателей, если это задание
было сдано.

## Задание 8 — Реализация паттерна Observer с использованием сигналов и слотов — 50 баллов

Ознакомьтесь с возможностями библиотеки boost.signals2.
<https://www.boost.org/doc/libs/1_86_0/doc/html/signals2.html>

Разработайте версию программы Weather Station Pro Duo, с использованием
данной библиотеки. Для класса WeatherData напишите модульные тесты.

Внимание, пользователи WeatherData должны иметь возможность подписаться на интересующие их
события.

Примеры паттерна "Наблюдатель", использующие boost.signals2:

- [Наблюдение за курсом валюты](../../samples/observer/ObserverWithSignallingValue/)
- [Наблюдение за курсом валюты, использующий объект `SignallingValue`](../../samples/observer/ObserverWithSignallingValue/)

[^1]: Автор не является ни биологом, ни рыболовом-любителем, поэтому
    может ошибаться. Предположим, что во Вселенной, в которой есть
    необходимость в программе Weather Station Pro, существуют рыбы,
    чувствительные к изменению атмосферного давления.
